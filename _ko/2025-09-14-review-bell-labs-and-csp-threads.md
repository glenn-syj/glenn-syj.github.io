---
title: 파이프로 살펴보는 동시성 - Xv6와 CSP Thread
lang: ko
layout: post
---

## 들어가며

- 이 글은 MIT에서 제공하는 과목인 Operating System Engineering(6.S081)을 학습하며, 파이프가 동시성 개념에서 어떤 역할을 하는지 느낀 바를 정리한 내용입니다.
- 학습용으로 사용되는 xv6에서 primes 과제를 수행하며, 각 소수마다 별도의 프로세스를 만들고 파이프를 통해 숫자를 전달하는 구조를 구현했습니다. (MIT 과제이므로 코드는 따로 공개하지 않았습니다.)

## 파이프 이해하기

### 파이프의 개념 및 역할

파이프(pipe)는 **프로세스 간 통신(Inter-Process Communication, IPC)**를 다루는 한 방식입니다. 파이프는 한 프로세스의 출력을 다른 프로세스의 입력으로 직접 연결하여 데이터를 전달합니다. 따라서 하나의 파이프는 한쪽 끝을 입력(읽기)으로 삼고 다른 쪽 끝을 출력(쓰기)으로 삼습니다.

파이프를 통해 전달되는 데이터는 바이트 스트림(byte stream) 형태로 이용됩니다. 따라서 파이프를 통해서 다양한 종류의 데이터를 유연하고 효율적으로 처리할 수 있습니다. 파이프는 데이터를 변환할 필요가 없으며, 어떤 종류의 데이터든 바이트로 표현될 수 있기 때문입니다. 대신 데이터를 읽는 프로세스는 데이터의 특성에 맞게 데이터를 해석해야 합니다.

### 실생활으로 파이프 이해하기

파이프라는 이름에서 드러나듯이, 실제로 삶과 밀접한 파이프를 떠올려보면 이해하기 쉽습니다. 대표적인 예시로 정수기에서 뜨거운 물을 마시고자 하는 예시가 있습니다. 여기에서 바이트 스트림은 '물'이라고 생각하면 쉽습니다.

첫 시작을 정수 과정 이후라고 생각하겠습니다.

1. 파이프
   - 출발: 외부 수도관
   - 끝: 필터가 있는 급수관 입구
   - 바이트 스트림: 물
2. 프로세스: 정수 필터
   - 정수 필터는 파이프로부터 물(바이트 스트림)을 받아서 물의 불순물을 제거함
   - 여기에서 정수 필터는 물의 불순물 수준을 파악하고, 걸러내는 역할 수행
3. 파이프
   - 시작: 정수된 물이 저장된 공간
   - 끝: 온수 가열 장치 입구
   - 바이트 스트림: 물
4. 프로세스: 온수 가열 장치
   - 온수 가열 장치는 파이프로부터 물(바이트 스트림)을 받아서 뜨거운 물로 변환
   - 여기에서 온수 가열 장치는 물의 온도를 해석하고, 특정 온도까지 가열시키는 역할 수행
5. 파이프
   - 시작: 온수 탱크 출수 대기 지점 (온수 가열 장치 이후에 물이 나오는 지점)
   - 끝: 출수구
   - 바이트 스트림: 물

위 예시에서 파이프는 단순히 '물'이라는 바이트 스트림을 전달하는 역할만 할 뿐, 어떠한 해석이나 변환도 거치지 않음에 주목할 필요가 있습니다. 파이프는 단방향으로 데이터를 전송하고, 해석하고 변환하는 역할은 프로세스가 다룹니다. 정수 필터와 온수 가열 장치처럼요.
